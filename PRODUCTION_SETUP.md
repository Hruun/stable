# üöÄ Gemini Production AI Editor - Setup Guide\n\nThis document provides step-by-step instructions for setting up the production-ready Gemini AI Editor with secure backend proxy architecture.\n\n## üîê Security Architecture\n\n**CRITICAL**: This implementation uses a **backend proxy pattern** to ensure API keys are never exposed in the frontend. The React app communicates with a Node.js/Express server, which then makes secure calls to the Gemini API.\n\n```\n[React Frontend] ‚Üí [Express Backend] ‚Üí [Gemini API]\n```\n\n## üìã Prerequisites\n\n- Node.js 20.12+ (current version in environment)\n- npm 10.5+\n- Gemini API key from [Google AI Studio](https://aistudio.google.com/)\n\n## üõ†Ô∏è Installation\n\n1. **Install dependencies**:\n   ```bash\n   npm install\n   ```\n\n2. **Set up environment variables**:\n   ```bash\n   cp .env.example .env.local\n   ```\n   \n   Edit `.env.local` and add your Gemini API key:\n   ```bash\n   GEMINI_API_KEY=your_actual_api_key_here\n   PORT=3001\n   FRONTEND_URL=http://localhost:5173\n   NODE_ENV=development\n   ```\n\n## üöÄ Development\n\n### Option 1: Run Both Frontend and Backend Together (Recommended)\n```bash\nnpm run dev:full\n```\nThis starts both the Express server (port 3001) and Vite dev server (port 5173).\n\n### Option 2: Run Separately\n```bash\n# Terminal 1: Start backend server\nnpm run server\n\n# Terminal 2: Start frontend\nnpm run dev\n```\n\n## üåê Access the Application\n\n- **Frontend**: http://localhost:5173\n- **Backend API**: http://localhost:3001\n- **Health Check**: http://localhost:3001/api/health\n\n## üéØ Key Features Implemented\n\n### 1. **Secure Backend Proxy**\n- API keys never exposed to frontend\n- Express server handles all Gemini API communication\n- CORS configuration for frontend-backend communication\n\n### 2. **Audio Upload & Processing**\n- Secure file upload to Gemini Files API\n- Automatic file state monitoring (PROCESSING ‚Üí ACTIVE)\n- Support for multiple audio formats (MP3, WAV, AAC, OGG, FLAC)\n- File size validation (100MB limit)\n\n### 3. **Real-time Streaming**\n- Server-Sent Events (SSE) for live transcription\n- Real-time diff generation during AI editing\n- Streaming text display with cursor animation\n\n### 4. **Advanced Model Configuration**\n- Full control over Gemini model parameters\n- Temperature, Top-P, Top-K adjustment\n- System instruction presets for different use cases\n- Model selection (Gemini 2.5 Pro, 2.5 Flash, etc.)\n\n### 5. **VSCode-Style Diff Editor**\n- Monaco Editor integration\n- Inline diff view (like VSCode)\n- Accept/reject changes functionality\n- Full-screen editing mode\n- Syntax highlighting and advanced editing features\n\n### 6. **Production-Ready Error Handling**\n- Exponential backoff retry logic\n- Rate limiting with request queuing\n- Comprehensive error messages\n- Graceful degradation\n\n### 7. **Rate Limiting & Queue Management**\n- Automatic rate limiting (15 RPM for free tier)\n- Request queuing to prevent API quota exhaustion\n- Smart retry logic for transient failures\n\n## üé® Using the Editor\n\n### Basic Workflow\n1. **Upload Audio**: Click the file input and select an audio file\n2. **Configure Model**: Adjust temperature, model selection, system instructions\n3. **Transcribe**: Click \"Transcribe Audio\" to generate initial transcript\n4. **Edit**: Enter edit instructions and click \"Apply AI Edit\"\n5. **Review Diff**: Use the Monaco diff editor to accept/reject changes\n\n### Predefined Edit Prompts\n- Fix grammar and spelling errors\n- Improve clarity and readability\n- Add proper punctuation and capitalization\n- Remove filler words (um, uh, like)\n- Format as professional meeting notes\n- Summarize key points and action items\n- Convert to bullet points\n\n### Advanced System Instructions\nThe editor includes preset system instructions for different scenarios:\n- **Transcriber**: Accurate transcription with speaker labels\n- **Transcript Editor**: Generates unified diff format\n- **JSON Formatter**: Outputs valid JSON only\n- **Code Reviewer**: Provides code improvement diffs\n\n## üîß API Endpoints\n\n### Backend Server Endpoints\n\n#### `POST /api/upload-audio`\nUpload audio file to Gemini Files API\n- **Input**: FormData with audio file\n- **Output**: `{ fileUri, fileName, mimeType }`\n\n#### `POST /api/stream-response`\nStreaming content generation with SSE\n- **Input**: `{ fileUri, prompt, systemInstruction, config }`\n- **Output**: Server-Sent Events stream\n\n#### `POST /api/generate-content`\nNon-streaming content generation\n- **Input**: `{ fileUri, prompt, systemInstruction, config }`\n- **Output**: `{ text, usageMetadata }`\n\n#### `GET /api/health`\nHealth check endpoint\n- **Output**: `{ status: 'OK', timestamp }`\n\n## üõ°Ô∏è Security Best Practices\n\n### Environment Variables\n- ‚úÖ API keys stored server-side only\n- ‚úÖ Environment variables in `.env.local` (not committed)\n- ‚úÖ CORS configuration restricts frontend origins\n\n### File Upload Security\n- ‚úÖ File type validation\n- ‚úÖ File size limits (100MB)\n- ‚úÖ Memory storage (no disk persistence)\n- ‚úÖ Server-side processing only\n\n### API Security\n- ‚úÖ Rate limiting and request queuing\n- ‚úÖ Error handling without sensitive data exposure\n- ‚úÖ Retry logic with exponential backoff\n- ‚úÖ Request validation and sanitization\n\n## üöÄ Production Deployment\n\n### Environment Setup\n1. Set production environment variables:\n   ```bash\n   GEMINI_API_KEY=your_production_api_key\n   NODE_ENV=production\n   PORT=3001\n   FRONTEND_URL=https://yourdomain.com\n   ```\n\n2. Build the frontend:\n   ```bash\n   npm run build\n   ```\n\n3. Start the production server:\n   ```bash\n   npm start\n   ```\n\n### Recommended Production Setup\n- **Reverse Proxy**: Use Nginx to serve static files and proxy API requests\n- **Process Manager**: Use PM2 for Node.js process management\n- **SSL/TLS**: Enable HTTPS for secure communication\n- **Monitoring**: Set up logging and error monitoring\n- **Rate Limiting**: Consider additional rate limiting at nginx level\n\n## üß™ Testing\n\n### Manual Testing Checklist\n- [ ] Audio upload works for different formats\n- [ ] Health check endpoint responds\n- [ ] Transcription generates text\n- [ ] Streaming shows real-time updates\n- [ ] Diff editor displays changes correctly\n- [ ] Accept/reject changes functions properly\n- [ ] Error handling displays user-friendly messages\n- [ ] Model configuration changes take effect\n- [ ] Rate limiting prevents quota exhaustion\n\n### Test Audio Files\nRecommended test files:\n- **Small**: 30 seconds (~1 MB) - Basic functionality\n- **Medium**: 5 minutes (~10 MB) - Performance testing\n- **Large**: 1 hour (~100 MB) - Stress testing\n\n## üêõ Troubleshooting\n\n### Common Issues\n\n#### \"GEMINI_API_KEY environment variable is required\"\n- ‚úÖ Ensure `.env.local` file exists with valid API key\n- ‚úÖ Restart the server after adding environment variables\n- ‚úÖ Check API key is valid in Google AI Studio\n\n#### \"Upload failed\" or \"Stream request failed\"\n- ‚úÖ Verify backend server is running on port 3001\n- ‚úÖ Check CORS configuration matches frontend URL\n- ‚úÖ Test health check endpoint: http://localhost:3001/api/health\n\n#### \"429 Rate limit exceeded\"\n- ‚úÖ Wait for quota reset (every minute for free tier)\n- ‚úÖ Reduce request frequency\n- ‚úÖ Consider upgrading to paid tier for higher limits\n\n#### Monaco Editor not loading\n- ‚úÖ Check browser console for loading errors\n- ‚úÖ Ensure Monaco Editor assets are properly bundled\n- ‚úÖ Try refreshing the page\n\n### Debug Mode\nEnable detailed logging:\n```bash\nNODE_ENV=development npm run server\n```\n\n## üìä Performance Optimization\n\n### Token Usage\n- Audio uses ~32 tokens per second\n- 1-hour audio ‚âà 115,200 tokens\n- Monitor token usage with `usageMetadata` in responses\n\n### Caching Strategies\n- Transcripts cached in browser localStorage\n- Audio files cached in Gemini (48-hour expiration)\n- Consider implementing server-side transcript caching\n\n### Model Selection\n- **Gemini 2.5 Flash**: Fast, cost-effective for basic transcription\n- **Gemini 2.5 Pro**: Advanced reasoning for complex editing tasks\n- **Temperature 0.0**: Deterministic, focused outputs\n- **Temperature 1.0+**: Creative, varied outputs\n\n## ü§ù Integration with Existing Application\n\nTo integrate with your existing Plug transcription editor:\n\n1. **Add to existing contexts**:\n   ```typescript\n   // Add to DataContext or create new GeminiContext\n   import { GeminiProductionEditor } from './components/GeminiProductionEditor';\n   ```\n\n2. **Route integration**:\n   ```typescript\n   // Add as new tab/modal in your UI\n   <GeminiProductionEditor />\n   ```\n\n3. **Data flow integration**:\n   ```typescript\n   // Connect with existing transcript data\n   const handleAcceptChanges = (editedText: string) => {\n     // Update your existing transcript state\n     updateTranscriptVersion(editedText);\n   };\n   ```\n\n## üìö Additional Resources\n\n- [Google Gemini API Documentation](https://ai.google.dev/docs)\n- [Monaco Editor Documentation](https://microsoft.github.io/monaco-editor/)\n- [Server-Sent Events Guide](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)\n- [Express.js Security Best Practices](https://expressjs.com/en/advanced/best-practice-security.html)\n\n---\n\n**Ready to transcribe and edit with AI! üé§‚ú®**"